{"version":3,"sources":["../../../../build/babel/loader/index.ts"],"sourcesContent":["import { getOptions } from 'next/dist/compiled/loader-utils'\nimport { trace } from '../../../telemetry/trace'\nimport { Span } from '../../../telemetry/trace'\nimport transform from './transform'\nimport { NextJsLoaderContext } from './types'\n\nasync function nextBabelLoader(\n  this: NextJsLoaderContext,\n  parentTrace: Span,\n  inputSource: string,\n  inputSourceMap: object | null | undefined\n) {\n  const filename = this.resourcePath\n  const target = this.target\n  const loaderOptions = parentTrace\n    .traceChild('get-options')\n    .traceFn(() => getOptions(this))\n\n  const loaderSpanInner = parentTrace.traceChild('next-babel-turbo-transform')\n  const {\n    code: transformedSource,\n    map: outputSourceMap,\n  } = loaderSpanInner.traceFn(() =>\n    transform.call(\n      this,\n      inputSource,\n      inputSourceMap,\n      loaderOptions,\n      filename,\n      target,\n      loaderSpanInner\n    )\n  )\n\n  return [transformedSource, outputSourceMap]\n}\n\nconst nextBabelLoaderOuter = function nextBabelLoaderOuter(\n  this: NextJsLoaderContext,\n  inputSource: string,\n  inputSourceMap: object | null | undefined\n) {\n  const callback = this.async()\n\n  const loaderSpan = trace('next-babel-turbo-loader', this.currentTraceSpan?.id)\n  loaderSpan\n    .traceAsyncFn(() =>\n      nextBabelLoader.call(this, loaderSpan, inputSource, inputSourceMap)\n    )\n    .then(\n      ([transformedSource, outputSourceMap]) =>\n        callback?.(null, transformedSource, outputSourceMap || inputSourceMap),\n      (err) => {\n        callback?.(err)\n      }\n    )\n}\n\nexport default nextBabelLoaderOuter\n"],"names":[],"mappings":";;;;;AAA2B,GAAiC,CAAjC,YAAiC;AACtC,GAA0B,CAA1B,MAA0B;AAE1B,GAAa,CAAb,UAAa;;;;;;eAGpB,eAAe,CAE5B,WAAiB,EACjB,WAAmB,EACnB,cAAyC,EACzC,CAAC;IACD,KAAK,CAAC,QAAQ,QAAQ,YAAY;IAClC,KAAK,CAAC,MAAM,QAAQ,MAAM;IAC1B,KAAK,CAAC,aAAa,GAAG,WAAW,CAC9B,UAAU,EAAC,WAAa,GACxB,OAAO,SAhBe,YAAiC;;IAkB1D,KAAK,CAAC,eAAe,GAAG,WAAW,CAAC,UAAU,EAAC,0BAA4B;IAC3E,KAAK,GACH,IAAI,EAAE,iBAAiB,GACvB,GAAG,EAAE,eAAe,QAClB,eAAe,CAAC,OAAO,KAnBP,UAAa,SAoBrB,IAAI,OAEZ,WAAW,EACX,cAAc,EACd,aAAa,EACb,QAAQ,EACR,MAAM,EACN,eAAe;;;QAIX,iBAAiB;QAAE,eAAe;;AAC5C,CAAC;AAED,KAAK,CAAC,oBAAoB,YAAY,qBAAoB,CAExD,WAAmB,EACnB,cAAyC,EACzC,CAAC;QAGmD,GAAqB;IAFzE,KAAK,CAAC,QAAQ,QAAQ,KAAK;IAE3B,KAAK,CAAC,UAAU,OA3CI,MAA0B,SA2CrB,uBAAyB,IAAE,GAAqB,QAAhB,gBAAgB,cAArB,GAAqB,UAArB,CAAyB,QAAzB,CAAyB,GAAzB,GAAqB,CAAE,EAAE;IAC7E,UAAU,CACP,YAAY,KACX,eAAe,CAAC,IAAI,OAAO,UAAU,EAAE,WAAW,EAAE,cAAc;MAEnE,IAAI,GACD,iBAAiB,EAAE,eAAe;eAClC,QAAQ,aAAR,QAAQ,UAAR,CAAsE,QAAtE,CAAsE,GAAtE,QAAQ,CAAG,IAAI,EAAE,iBAAiB,EAAE,eAAe,IAAI,cAAc;QACtE,GAAG,GAAK,CAAC;QACR,QAAQ,aAAR,QAAQ,UAAR,CAAe,QAAf,CAAe,GAAf,QAAQ,CAAG,GAAG;IAChB,CAAC;AAEP,CAAC;eAEc,oBAAoB"}